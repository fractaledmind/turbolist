<article id="<%= dom_id task %>" class="flex h-full flex-col">
  <header class="z-10 space-y-6 bg-slate-100 dark:bg-slate-800 px-6 py-6">
    <div class="flex items-center justify-start gap-2">
      <%= link_to tasks_path, class: "inline-flex size-8 items-center justify-center rounded-full bg-slate-200 text-slate-500 hover:bg-slate-300 hover:text-slate-600 dark:bg-slate-700 dark:text-slate-400 dark:hover:bg-slate-600 dark:hover:text-white" do %>
        <%= icon "x-lg", classes: "size-4" %>
      <% end %>

      <%= button_to task, action: "update", form_class: "", params: { task: {completed: "toggle"} }, class: "inline-flex h-8 items-center justify-center rounded-full bg-slate-200 px-3 text-slate-500 hover:bg-slate-300 hover:text-slate-600 dark:bg-slate-700 dark:text-slate-400 dark:hover:bg-slate-600 dark:hover:text-white" do %>
        <% if task.completed? %>
          <%= icon "check-circle-fill", classes: "mr-2 size-4" %>
          Completed
        <% else %>
          <%= icon "check-circle", classes: "mr-2 size-4" %>
          Complete
        <% end %>
      <% end %>

      <details class="relative z-0 ml-auto">
        <summary class="marker-none cursor-pointer">
          <div class="inline-flex size-8 items-center justify-center rounded-full bg-slate-200 text-slate-500 hover:bg-slate-300 hover:text-slate-600 dark:bg-slate-700 dark:text-slate-400 dark:hover:bg-slate-600 dark:hover:text-white">
            <%= icon "three-dots_vertical", classes: "size-4" %>
          </div>
        </summary>
        <ul class="absolute right-0 z-50 w-48 overflow-hidden rounded-xl bg-slate-200 py-1 shadow dark:bg-slate-950">
          <li>
            <a href="#" class="flex items-center gap-2 whitespace-nowrap px-2 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
              <%= icon "arrow-bar-right", classes: "size-3" %>
              Unsubscribe
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-2 whitespace-nowrap px-2 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
              <%= icon "copy", classes: "size-3" %>
              Copy link
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-2 whitespace-nowrap px-2 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
              <%= icon "arrow-counterclockwise", classes: "size-3" %>
              Mark all incomplete
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-2 whitespace-nowrap px-2 py-1 text-red-500 hover:bg-slate-300 dark:hover:bg-slate-900">
              <%= icon "trash3 text-red-500", classes: "size-3" %>
              Delete task
            </a>
          </li>
        </ul>
      </details>
    </div>

    <div class="group flex flex-wrap items-center gap-x-2">
      <% if task.completed? %>
        <h1 class="w-11/12 text-3xl dark:text-slate-400 line-through decoration-orange-500" id="<%= dom_id(task, :title) %>"><%= task.title %></h1>
      <% else %>
        <%= form_with(model: task, class: "", data: { controller: 'autosave' }) do |form| %>
          <%= form.text_field :title, class: "peer w-11/12 bg-transparent text-3xl placeholder:text-slate-600 focus:outline-none", placeholder: "New task", autocomplete: false, value: form.object.title, id: dom_id(task, :title) %>
          <%= form.submit class: "sr-only" %>
        <% end %>
      <% end %>

      <details class="relative ml-auto">
        <summary class="marker-none cursor-pointer">
          <div class="inline-flex size-5 items-center justify-center rounded-full text-slate-400 hover:bg-slate-200 hover:text-slate-500 dark:bg-slate-700 dark:hover:bg-slate-700 dark:hover:text-white">
            <%= icon "person", classes: "size-3 text-slate-400" %>
          </div>
        </summary>
        <div class="absolute right-0 z-50 w-max max-w-md divide-y divide-slate-300 overflow-hidden rounded-xl bg-slate-200 py-1 shadow dark:divide-slate-800 dark:bg-slate-950">
          <div class="py-1" role="none">
            <div class="group flex items-center gap-2 whitespace-nowrap px-4 py-1 text-slate-800 dark:text-white">
              <%= icon "search", classes: "size-3 text-inherit" %>
              <input class="bg-transparent focus:outline-none" placeholder="Search for name" />
            </div>
          </div>
          <div class="py-1" role="none">
            <label class="group/label flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
              <input type="radio" name="assignee" class="peer hidden w-0 appearance-none" />
              <span class="inline-flex size-4 items-center justify-center rounded-full bg-blue-500">
                <span class="text-xs leading-none text-white">J</span>
              </span>
              John Doe
              <%= icon "check2", classes: "invisible ml-auto size-4 text-orange-500 peer-checked:visible" %>
            </label>
            <label class="group/label flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
              <input type="radio" name="assignee" class="peer hidden w-0 appearance-none" />
              <span class="inline-flex size-4 items-center justify-center rounded-full bg-green-500">
                <span class="text-xs leading-none text-white">S</span>
              </span>
              Sally Doe
              <%= icon "check2", classes: "invisible ml-auto size-4 text-orange-500 peer-checked:visible" %>
            </label>
          </div>
          <div class="p-2" role="none">
            <button type="button" class="h-8 w-full rounded-full bg-slate-300 hover:bg-slate-400 dark:bg-slate-900 dark:hover:bg-slate-800">Clear</button>
          </div>
        </div>
      </details>

      <div class="flex w-full items-center gap-1">
        <details class="relative z-0">
          <summary class="marker-none cursor-pointer">
            <div class="-ml-1 inline-flex items-center justify-center gap-1 rounded-full px-2 py-1 text-xs text-slate-400 hover:bg-slate-200 hover:text-slate-500 dark:hover:bg-slate-700 dark:hover:text-white">
              <%= icon "calendar3", classes: "size-2.5 text-slate-400" %>
            </div>
          </summary>
          <div class="absolute z-50 w-max max-w-md divide-y divide-slate-300 overflow-hidden rounded-xl bg-slate-200 py-1 shadow dark:divide-slate-800 dark:bg-slate-950">
            <div class="py-1" role="none">
              <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
                <%= icon "calendar3", classes: "size-3 text-slate-500" %>
                Today
              </a>
              <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
                <%= icon "calendar3", classes: "size-3 text-slate-500" %>
                Tomorrow
              </a>
              <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
                <%= icon "calendar3", classes: "size-3 text-slate-500" %>
                Next week
              </a>
            </div>
            <div class="py-1" role="none">
              <div class="flex items-center px-4 py-1">
                <h2 class="flex-auto text-sm font-semibold text-gray-900 dark:text-white">January 2022</h2>
                <button type="button" class="-my-1.5 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500">
                  <span class="sr-only">Previous month</span>
                  <%= icon "chevron-left", classes: "size-5" %>
                </button>
                <button type="button" class="-my-1.5 -mr-1.5 ml-2 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500">
                  <span class="sr-only">Next month</span>
                  <%= icon "chevron-right", classes: "size-5" %>
                </button>
              </div>
              <div class="grid grid-cols-7 px-1 py-2 text-center text-sm leading-6 text-gray-500 dark:text-white">
                <div>M</div>
                <div>T</div>
                <div>W</div>
                <div>T</div>
                <div>F</div>
                <div>S</div>
                <div>S</div>
              </div>
              <div class="mt-2 grid grid-cols-7 gap-1 px-2 text-sm">
                <!--
                  Always include: "mx-auto flex size-8 items-center justify-center rounded-full"
                  Is selected, include: "text-white"
                  Is not selected and is today, include: "text-indigo-600"
                  Is not selected and is not today and is current month, include: "text-gray-900"
                  Is not selected and is not today and is not current month, include: "text-gray-400"
                  Is selected and is today, include: "bg-indigo-600"
                  Is selected and is not today, include: "bg-gray-900"
                  Is not selected, include: "hover:bg-gray-200"
                  Is selected or is today, include: "font-semibold"
                -->
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2021-12-27">27</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2021-12-28">28</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2021-12-29">29</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2021-12-30">30</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2021-12-31">31</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-01">1</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-02">2</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-03">3</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-04">4</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-05">5</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-06">6</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-07">7</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-08">8</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-09">9</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-10">10</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-11">11</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full border border-slate-700 text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-12">12</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-13">13</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-14">14</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-15">15</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-16">16</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-17">17</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-18">18</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-19">19</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-20">20</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-21">21</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-22">22</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-23">23</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-24">24</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-25">25</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-26">26</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-27">27</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-28">28</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-29">29</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-30">30</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
                  <time datetime="2022-01-31">31</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2022-02-01">1</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2022-02-02">2</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2022-02-03">3</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2022-02-04">4</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2022-02-05">5</time>
                </button>
                <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
                  <time datetime="2022-02-06">6</time>
                </button>
              </div>
            </div>
            <div class="py-1" role="none">
              <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
                <%= icon "clock", classes: "size-3 text-slate-500 group-hover/link:text-slate-700 dark:text-slate-400 dark:group-hover/link:text-white" %>
                Time
              </a>
            </div>
            <div class="py-1" role="none">
              <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
                <%= icon "bell", classes: "size-3 text-slate-500 group-hover/link:text-slate-700 dark:text-slate-400 dark:group-hover/link:text-white" %>
                Remind me
              </a>
            </div>
            <div class="py-1" role="none">
              <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
                <%= icon "repeat", classes: "size-3 text-slate-500 group-hover/link:text-slate-700 dark:text-slate-400 dark:group-hover/link:text-white" %>
                Repeat
              </a>
            </div>
          </div>
        </details>

        <%= render "labels_popover_form", task: task %>

        <%= render "list_popover_form", task: task %>
      </div>
    </div>
  </header>

  <section class="my-4 flex flex-grow flex-col justify-end">
    <%= form_with(model: task, class: "flex-grow px-6 flex flex-col mb-4") do |form| %>
      <%= form.rich_text_area :description, rows: 10, class: "h-full", placeholder: "Start typing..." %>
      <%= form.submit class: "sr-only" %>
    <% end %>

    <p class="text-center text-sm text-slate-400 dark:text-gray-500">
      Created by Stephen &middot;

      <abbr title="<%= task.created_at.to_formatted_s %>" class="cursor-help">
        <%= time_tag task.created_at, "#{time_ago_in_words(task.created_at, scope: 'datetime.distance_in_words.short')} ago" %>
      </abbr>
    </p>
  </section>

  <form class="px-6 py-2">
    <input type="text" name="messages[content]" id="message_content" placeholder="Leave a message" class="w-full rounded-full border border-slate-200 bg-slate-200 dark:bg-slate-800 px-4 py-2 dark:border-slate-700" />
  </form>
</article>
