<%= form_with(model: task, class: "", data: { controller: :form, action: "turbo:submit-end->form#clear" }) do |form| %>
  <%= form.label :title, class: "peer block hover:bg-slate-200 dark:hover:bg-slate-800 py-1 group/input " do %>
    <div class="max-w-3xl px-12 mx-auto w-full flex gap-x-2 items-center [view-transition-name:taskform]">
      <%= icon "app-indicator", classes: "size-6 text-slate-400 dark:text-slate-600" %>
      <%= form.text_field :title, class: "peer bg-transparent focus:w-10/12 w-[7ch] placeholder:text-slate-600 focus:outline-none", placeholder: "New task", autocomplete: false, value: form.object.title || "" %>
      <span class="peer-focus:invisible inline-flex items-center justify-center size-5 rounded-full bg-slate-200 text-slate-500 dark:bg-slate-800 dark:text-slate-600 dark:group-hover/input:bg-slate-700 dark:group-hover/input:text-slate-500">C</span>
      <details class="ml-auto invisible group-hover/input:visible peer-focus:visible open:visible relative">
        <summary class="marker-none cursor-pointer">
          <div class="size-5 text-slate-400 hover:bg-slate-200 hover:text-slate-500 dark:hover:bg-slate-700 dark:hover:text-white inline-flex items-center justify-center rounded-full">
            <%= icon "person", classes: "size-2.5 text-slate-400" %>
          </div>
        </summary>
        <div class="absolute z-50 max-w-md w-max py-1 bg-slate-200 dark:bg-slate-950 shadow rounded-xl overflow-hidden divide-y divide-slate-300 dark:divide-slate-800">
          <div class="py-1" role="none">
            <div class="group flex items-center gap-2 px-4 py-1 text-slate-800 dark:text-white whitespace-nowrap">
              <%= icon "search", classes: "size-3 text-inherit" %>
              <input class="bg-transparent focus:outline-none" placeholder="Search for name">
            </div>
          </div>
          <div class="py-1" role="none">
            <label class="group/label flex items-center gap-2 px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900 whitespace-nowrap">
              <input type="radio" name="assignee" class="peer appearance-none w-0 hidden">
              <span class="inline-flex size-4 items-center justify-center rounded-full bg-blue-500">
                <span class="text-xs leading-none text-white">J</span>
              </span>
              John Doe
              <%= icon "check2", classes: "invisible ml-auto size-4 text-orange-500 peer-checked:visible" %>
            </label>
            <label class="group/label flex items-center gap-2 px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900 whitespace-nowrap">
              <input type="radio" name="assignee" class="peer appearance-none w-0 hidden">
              <span class="inline-flex size-4 items-center justify-center rounded-full bg-green-500">
                <span class="text-xs leading-none text-white">S</span>
              </span>
              Sally Doe
              <%= icon "check2", classes: "invisible ml-auto size-4 text-orange-500 peer-checked:visible" %>
            </label>
          </div>
          <div class="p-2" role="none">
            <button type="button" class="rounded-full bg-slate-300 hover:bg-slate-400 dark:bg-slate-900 dark:hover:bg-slate-800 h-8 w-full">
              Clear
            </button>
          </div>
        </div>
      </details>
    </div>
  <% end %>
  <div class="max-w-3xl px-12 mx-auto w-full flex items-center gap-1 pointer-events-none ease-out duration-200 opacity-0 -translate-y-6 peer-focus-within:opacity-100 peer-focus-within:translate-y-0 peer-focus-within:pointer-events-auto focus-within:opacity-100 focus-within:translate-y-0 focus-within:pointer-events-auto">
    <span class="w-6">&nbsp;</span>
    <details class="relative z-0">
      <summary class="marker-none cursor-pointer">
        <div class="-ml-1 inline-flex items-center justify-center gap-1 rounded-full px-2 py-1 text-xs text-slate-400 hover:bg-slate-200 hover:text-slate-500 dark:hover:bg-slate-700 dark:hover:text-white">
          <%= icon "calendar3", classes: "size-2.5 text-slate-400" %>
        </div>
      </summary>
      <div class="absolute z-50 w-max max-w-md divide-y divide-slate-300 overflow-hidden rounded-xl bg-slate-200 py-1 shadow dark:divide-slate-800 dark:bg-slate-950">
        <div class="py-1" role="none">
          <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
            <%= icon "calendar3", classes: "size-3 text-slate-500" %>
            Today
          </a>
          <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
            <%= icon "calendar3", classes: "size-3 text-slate-500" %>
            Tomorrow
          </a>
          <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
            <%= icon "calendar3", classes: "size-3 text-slate-500" %>
            Next week
          </a>
        </div>
        <div class="py-1" role="none">
          <div class="flex items-center px-4 py-1">
            <h2 class="flex-auto text-sm font-semibold text-gray-900 dark:text-white">January 2022</h2>
            <button type="button" class="-my-1.5 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500">
              <span class="sr-only">Previous month</span>
              <%= icon "chevron-left", classes: "size-5" %>
            </button>
            <button type="button" class="-my-1.5 -mr-1.5 ml-2 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500">
              <span class="sr-only">Next month</span>
              <%= icon "chevron-right", classes: "size-5" %>
            </button>
          </div>
          <div class="grid grid-cols-7 px-1 py-2 text-center text-sm leading-6 text-gray-500 dark:text-white">
            <div>M</div>
            <div>T</div>
            <div>W</div>
            <div>T</div>
            <div>F</div>
            <div>S</div>
            <div>S</div>
          </div>
          <div class="mt-2 grid grid-cols-7 gap-1 px-2 text-sm">
            <!--
              Always include: "mx-auto flex size-8 items-center justify-center rounded-full"
              Is selected, include: "text-white"
              Is not selected and is today, include: "text-indigo-600"
              Is not selected and is not today and is current month, include: "text-gray-900"
              Is not selected and is not today and is not current month, include: "text-gray-400"
              Is selected and is today, include: "bg-indigo-600"
              Is selected and is not today, include: "bg-gray-900"
              Is not selected, include: "hover:bg-gray-200"
              Is selected or is today, include: "font-semibold"
            -->
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2021-12-27">27</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2021-12-28">28</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2021-12-29">29</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2021-12-30">30</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2021-12-31">31</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-01">1</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-02">2</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-03">3</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-04">4</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-05">5</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-06">6</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-07">7</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-08">8</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-09">9</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-10">10</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-11">11</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full border border-slate-700 text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-12">12</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-13">13</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-14">14</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-15">15</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-16">16</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-17">17</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-18">18</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-19">19</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-20">20</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-21">21</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-22">22</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-23">23</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-24">24</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-25">25</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-26">26</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-27">27</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-28">28</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-29">29</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-30">30</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-900 hover:bg-orange-600/50 dark:text-white">
              <time datetime="2022-01-31">31</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2022-02-01">1</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2022-02-02">2</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2022-02-03">3</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2022-02-04">4</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2022-02-05">5</time>
            </button>
            <button type="button" class="mx-auto flex size-8 items-center justify-center rounded-full text-gray-400 hover:bg-orange-600/50 dark:text-slate-400">
              <time datetime="2022-02-06">6</time>
            </button>
          </div>
        </div>
        <div class="py-1" role="none">
          <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
            <%= icon "clock", classes: "size-3 text-slate-500 group-hover/link:text-slate-700 dark:text-slate-400 dark:group-hover/link:text-white" %>
            Time
          </a>
        </div>
        <div class="py-1" role="none">
          <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
            <%= icon "bell", classes: "size-3 text-slate-500 group-hover/link:text-slate-700 dark:text-slate-400 dark:group-hover/link:text-white" %>
            Remind me
          </a>
        </div>
        <div class="py-1" role="none">
          <a href="#" class="group/link flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-300 dark:hover:bg-slate-900">
            <%= icon "repeat", classes: "size-3 text-slate-500 group-hover/link:text-slate-700 dark:text-slate-400 dark:group-hover/link:text-white" %>
            Repeat
          </a>
        </div>
      </div>
    </details>
    <turbo-frame id="<%= dom_id(task, :labels) %>">
      <details class="relative z-0" <%= "open" if turbo_frame_request_id.present? %>>
        <summary class="marker-none cursor-pointer">
          <div class="-ml-1 inline-flex items-center justify-center gap-1 rounded-full px-2 py-1 text-xs text-slate-400 hover:bg-slate-200 hover:text-slate-500 dark:hover:bg-slate-700 dark:hover:text-white">
            <%= icon "tag", classes: "size-2.5 text-slate-400" %>
            <%= task.labels.join(", ") %>
          </div>
        </summary>
        <div class="absolute z-50 w-max max-w-md divide-y divide-slate-300 overflow-hidden rounded-xl bg-slate-200 py-1 shadow dark:divide-slate-800 dark:bg-slate-950"
            data-controller="checkboxes">
          <%= form_with(model: task, class: "", data: { controller: 'autosave' }) do |form| %>
            <div class="py-1" role="none">
              <div class="group flex items-center gap-2 whitespace-nowrap px-4 py-1 text-slate-800 dark:text-white">
                <%= icon "search", classes: "size-3 text-inherit" %>
                <input class="bg-transparent focus:outline-none" placeholder="Search or create label" />
              </div>
            </div>
            <div class="py-1" role="none">
              <%= form.collection_check_boxes :labels, Task.unique_labels, :itself, :itself do |builder| %>
                <%= builder.label class: "group/label flex items-center gap-2 whitespace-nowrap px-4 py-1 hover:bg-slate-400 dark:hover:bg-slate-900 has-[:checked]:bg-slate-300 dark:has-[:checked]:bg-slate-800" do %>
                  <%= builder.check_box class: "peer hidden w-0 appearance-none", data: { action: 'autosave#save', checkboxes_target: "child" } %>
                  <%= icon "tag", classes: "size-3 text-slate-500 group-hover/label:text-slate-600 peer-checked:text-orange-700 dark:text-slate-400 dark:group-hover/label:text-white dark:peer-checked:text-orange-500" %>
                  <%= builder.text %>
                  <%= icon "check2", classes: "invisible ml-auto size-4 text-orange-700 dark:text-orange-500 peer-checked:visible" %>
                <% end %>
              <% end %>
            </div>
            <div class="p-2" role="none">
              <button type="button" class="h-8 w-full rounded-full bg-slate-300 hover:bg-slate-400 dark:bg-slate-900 dark:hover:bg-slate-800" data-action="checkboxes#deselectAllAndSubmit">Clear</button>
            </div>

            <%= form.submit class: "sr-only" %>
          <% end %>
        </div>
      </details>
    </turbo-frame>
  </div>

  <%= form.submit class: "sr-only" %>
<% end %>
